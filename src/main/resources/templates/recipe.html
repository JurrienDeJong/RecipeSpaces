<!DOCTYPE html>
<!--
    Displays the recipe and their properties
    author: JurriÃ«n de Jong (function), Rose Hazenberg (styling)
-->
<html xmlns:th="http://www.thymeleaf.org">
<title th:text="#{tab.title.recipe(${recipeName})}">_offline_</title>
<head>
    <!-- jQuery -->
    <script type="text/javascript"
            src="https://code.jquery.com/jquery-3.5.1.js">
    </script>

    <!-- DataTables CSS -->
    <link rel="stylesheet"
          href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.min.css">

    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js">
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js">

    </script>

    <link th:href="@{/css/stylesheet.css}" rel="stylesheet" />
</head>

<div th:insert="template :: background(${recipeName})"></div>

<body class="portfolio-section">
    <h1>Ingredients needed:</h1>
    <table id="ingredients" class="display nowrap">
        <tbody>
        <tr th:each="ingredient : ${ingredients}">
            <td class="table-style"><a th:href="@{'/ingredient/' + ${ingredient.getId()}}" th:text="${ingredient.getTagValue()}"></a></td>
        </tr>
        </tbody>
    </table>

    <br>

    <h1>Ingredients:</h1>
    <ul>
        <li th:each="amount:${ingredient_amount}"
            th:text="${amount.tagValue}"></li>
    </ul>

<!--    <h1>Ingredient frequency:</h1>-->
<!--    <table>-->
<!--        <tbody>-->
<!--            <tr th:each="ing : ${ing_frequency}">-->
<!--                <td th:text="${ing.values()[0]}"></td>-->
<!--                <td th:text="${ing.values()[1]}"></td>-->
<!--                <td th:text="${ing.values()[2]}"></td>-->
<!--            </tr>-->
<!--        </tbody>-->
<!--    </table>-->

<!--        <h1>Ingredient in recipe:</h1>-->
<!--        <table>-->
<!--            <tbody>-->
<!--                <tr th:each="rec : ${recipe_ingredient}">-->
<!--                    <td th:text="${rec.values()[0]}"></td>-->
<!--                    <td th:text="${rec.values()[1]}"></td>-->
<!--                </tr>-->
<!--            </tbody>-->
<!--        </table>-->

    <h1>Steps:</h1>
    <ul>
        <li th:each="step:${steps}"
            th:text="${step.tagValue}"></li>
    </ul>



    <script>
        $(document).ready(function() {
            $('#recipe').DataTable({
                bFilter : false,
                "bLengthChange": false
            })

        });
        $(document).ready(function() {
            $('#ingredients').DataTable({
                bFilter : false,
                "bLengthChange": false
            })

        });
        $(document).ready(function() {
            $('#ingredient_amount').DataTable({
                bFilter : false,
                "bLengthChange": false
            })

        });
        $(document).ready(function() {
            $('#steps').DataTable({
                bFilter : false,
                "bLengthChange": false
            })

        });
    </script>



    <div id="plot-example" data-plot-xMin="-1"></div>

    <canvas id="recipe-name" width="600" height="400"></canvas>


    <script th:inline="javascript">
        var htmldata = [[${ing_frequency}]];

        // var recipeIngredientData = [[${recipe_ingredient}]];
        //
        // console.log(recipeIngredientData);

        var frequency = {};
        var recipes = {};

        for (var i=0; i < htmldata.length; i++) {
            frequency[htmldata[i].name] = htmldata[i].count
            recipes[htmldata[i].name] = htmldata[i].recipe
        }

        var pointBackgroundColors = [];

        var recipeData = {
            labels : Object.keys(frequency),
            datasets : [
                {
                    barThickness: 6,
                    data : Object.values(frequency),
                    backgroundColor: pointBackgroundColors
                }
            ],
        }

        var recipe = document.getElementById('recipe-name').getContext('2d');
        var myChart = new Chart(recipe, {
            type: 'bar',
            data: recipeData,
            valueField: 'count',
            argumentField: 'name',
            options: {
                legend: {
                    display: false
                },
                scaleShowValues: true,
                scales: {
                    xAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: 'Ingredient'
                        },
                        ticks: {
                            autoSkip: false
                        }
                    }],
                    yAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: 'Frequency'
                        },
                        ticks: {
                            min: 0
                        }
                    }]
                },
                tooltips: {
                    enabled: true,
                    mode: 'single',
                    callbacks: {
                        label: function (tooltipItems, data) {
                            var multistringText = [tooltipItems.yLabel];
                            multistringText.push("Another item");
                            multistringText.push(Object.values(food));
                            multistringText.push('One more Item');
                            return multistringText;
                        }
                    }
                }
            }
        });

        for (i = 0; i < myChart.data.datasets[0].data.length; i++) {
            if (myChart.data.datasets[0].data[i] > 20) {
                pointBackgroundColors.push("#2471A3");
            } else {
                pointBackgroundColors.push("#239B56");
            }
        }

        myChart.update();
    </script>
</body>
</html>